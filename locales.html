<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="lib/3rdparty/jquery.js"></script>

<title>Locales Data</title>
  
<script>
var LocaleTable = function() {
  this.locales = {};
  this.tableEl = $('<table id="localeTable">').appendTo(document.body);
  this.loadData();
};
LocaleTable.prototype = {
  _caseInsensitiveCompare: function(a, b) {
    return a.toUpperCase().localeCompare(b.toUpperCase());
  },

  prepareLocaleData: function() {
    this.orderedLocaleCodes = [];
    for(var localeCode in this.locales) {
      this.orderedLocaleCodes.push(localeCode);
    }
    this.orderedLocaleCodes.sort(this._caseInsensitiveCompare);

    this.orderedKeywords = [];
    for(var i = 0, len = this.orderedLocaleCodes.length; i < len; ++i) {
      var localeData = this.locales[this.orderedLocaleCodes[i]];
      for(var keyword in localeData) {
        if($.inArray(keyword, this.orderedKeywords) == -1) {
          this.orderedKeywords.push(keyword);
        }
      }
    }
    this.orderedKeywords.sort(this._caseInsensitiveCompare);
  },

  drawTable: function() {
    this.prepareLocaleData();
    this.tableEl.empty();

    var emptyCount = {};
    for(var i = 0, len = this.orderedKeywords.length; i < len; ++i) {
      var keyword = this.orderedKeywords[i];
      var rowEl = $('<tr>');
      var titleCellEl = $('<th>').html(keyword);
      rowEl.append(titleCellEl);
      var isKeywordComplete = true;
      for(var j = 0, len2 = this.orderedLocaleCodes.length; j < len2; ++j) {
        var localeCode = this.orderedLocaleCodes[j];
        var localeData = this.locales[localeCode];
        var message = localeData.hasOwnProperty(keyword) ? localeData[keyword].message : '-';
        var className = '';
        if(message == '-') {
          className = 'empty';
          emptyCount[localeCode] = emptyCount[localeCode] ? emptyCount[localeCode] + 1 : 1;
          isKeywordComplete = false;
        }
        var cellEl = $('<td>').addClass(className).html(message);
        rowEl.append(cellEl);
      }
      var isPropertyInDefault = this.locales[this.defaultLocale] && this.locales[this.defaultLocale].hasOwnProperty(keyword);
      if(!isPropertyInDefault) {
        rowEl.addClass('invalid');
      } else if(!isKeywordComplete) {
        rowEl.addClass('incomplete');
      }
      this.tableEl.append(rowEl);
    }

    var titleRowEl = $('<tr>').append($('<th>'));
    for(var k = 0, len3 = this.orderedLocaleCodes.length; k < len3; ++k) {
      var code = this.orderedLocaleCodes[k];
      var localeCellEl = $('<th>').html(code);
      if(emptyCount[code]) {
        localeCellEl.append($('<span>').addClass('empty_count').html(' (' + emptyCount[code] + ')'))
      }
      titleRowEl.append(localeCellEl);
    }
    this.tableEl.prepend(titleRowEl);
  },

  loadData: function() {
    var _this = this;
    this.loadDefaultLocale(function(defaultLocale) {
      _this.defaultLocale = defaultLocale;
      _this.loadLocaleMessages(function(locales) {
        _this.locales = locales;
        _this.drawTable();
      });
    })
  },

  loadDefaultLocale: function(callback) {
    $.ajax({
      type: 'GET',
      url: 'manifest.json',
      data: {},
      dataType: 'json',
      timeout: 5000,
      success: function(data, status, xhr) {
        if(data) {
          callback(data.default_locale);
        }
      }
    });
  },

  loadLocaleMessages: function(callback) {
    var remainingLocalesMap = {};
    $.each(LocaleTable.availableLocaleCodes, function() {
      remainingLocalesMap[this] = true;
    });
    var locales = {};
    var updateLocaleCallback = function(localeCode, data) {
      delete remainingLocalesMap[localeCode];
      if(data) {
        locales[localeCode] = data;
      }
      if($.isEmptyObject(remainingLocalesMap)) {
        callback(locales);
      }
    };
    for(var i = 0, len = LocaleTable.availableLocaleCodes.length; i < len; ++i) {
      var localeCode = LocaleTable.availableLocaleCodes[i];
      (function(localeCode) {
        $.ajax({
          type: 'GET',
          url: '_locales/' + localeCode + '/messages.json',
          data: {},
          dataType: 'json',
          timeout: 5000,
          success: function(data, status, xhr) {
            updateLocaleCallback(localeCode, data);
          },
          error: function() {
            updateLocaleCallback(localeCode, null);
          }
        });
      })(localeCode);
    }
  }
};
LocaleTable.availableLocaleCodes = ["am", "ar", "bg", "bn", "ca", "cs", "da", "de", "el", "en", "en_GB", "en_US", "es",
  "es_419", "et", "fi", "fil", "fr", "gu", "he", "hi", "hr", "hu", "id", "it", "ja", "kn", "ko", "lt", "lv",
  "ml", "mr", "nb", "nl", "or", "pl", "pt", "pt_BR", "pt_PT", "ro", "ru", "sk", "sl", "sr", "sv", "sw",
  "ta", "te", "th", "tr", "uk", "vi", "zh", "zh_CN", "zh_TW"];

$(function() {
  new LocaleTable();
});

</script>
<style>
#localeTable {
  border-collapse: collapse;
}
#localeTable, #localeTable td, #localeTable th {
  border: 1px solid black;
}
#localeTable td {
  width: 300px;
}
#localeTable td.empty {
  background-color: #fcc;
}
#localeTable tr.invalid td, #localeTable tr.invalid th {
  background-color: #ff0;
}
#localeTable tr.incomplete th {
  color: red;
}
span.empty_count {
  color: red;
}
</style>
</head>
<body>
</body>
</html>